{"version":3,"file":"load_img.min.js","sources":["load_img.js"],"sourcesContent":["/**\n *  Load images asynchronously and cache them.\n *\n *  @license MIT\n *  @git https://github.com/duzun/jquery.load_img\n *  @author Dumitru Uzun (DUzun.Me)\n *  @version 1.3.0\n */\n\n// ---------------------------------------------------------------------------\nexport const VERSION   = '1.3.0';\n\nexport default function init($) {\n        var undefined; //jshint ignore:line\n        const UNDEFINED = undefined + '';\n\n        // ---------------------------------------------------------------------------\n        var document = window.document\n        ,   cache = {}\n        ;\n\n        /**\n         * Load an image to cache.\n         *\n         * @param string src - source URL of the iamge\n         * @param callback clb.call(img: $(Image), src|false, event: $.Event)\n         *\n         * @return $(Image) element\n         */\n        function load_img(src, clb) {\n            var img = $('<img />')\n            ,   hasClb = 'function' == typeof clb\n            ,   defered = hasClb ? undefined : new $.Deferred()\n            ,   ret = function ret(evt) {\n                    var type = evt.type\n                    ,   error = type == 'error'\n                    ;\n                    evt.src = src;\n                    cache[src] = !error;\n                    img.off(error?'load':'error', ret).remove();\n                    img.show();\n                    if(hasClb) {\n                        clb.call(img, error?false:src, evt);\n                    }\n                    else if ( defered ) {\n                        if ( error ) {\n                            defered.reject(evt);\n                        }\n                        else {\n                            defered.resolve(evt, src);\n                        }\n                    }\n                }\n            ,   that = this\n            ,   ctx = that && that != $ && that.$ctx\n            ;\n            if ( defered ) {\n                img.then = $.proxy(defered.then, defered);\n                img.promise = $.proxy(defered.promise, defered);\n            }\n            img\n                .hide()\n                .one('load', ret)\n                .one('error', ret)\n            ;\n            if(cache[src] === false) {\n                img.trigger('error');\n            }\n            else {\n                if(!ctx || !ctx.length || ctx[0] == document) {\n                    ctx = $(document.body||'body');\n                }\n                if(!ctx.length) {\n                    var tio = setInterval(function () {\n                        if(document.body) {\n                            clearInterval(tio);\n                            ctx = $(document.body);\n                            img.prop('src', src);\n                            ctx.append(img);\n                        }\n                    }, 50);\n                }\n                else {\n                    img.prop('src', src);\n                    ctx.append(img);\n                }\n            }\n            return img;\n        }\n\n        /**\n         * Check whether src has beed loaded (either success or error)\n         *\n         * @param string src - source URL of the iamge\n         *\n         * @return bool true if src in cache, false otherwise\n         */\n        function inCache(src) {\n            return src in cache;\n        }\n\n        /**\n         * Check whether image with src exists.\n         *\n         * @param string src - source URL of the iamge\n         * @param callback cb(src|false)\n         *\n         * Note: If cb supplied and src not in cache, it will trigger\n         *\n         * @return bool|undefined true if exists (and cached), false if doesn't exist (error on load), undefined if never loaded (not in cache)\n         */\n        function exists(src, cb) {\n            if ( src in cache ) {\n                cb && cb(cache[src]&&src);\n                return cache[src];\n            }\n            else {\n                cb && load_img(src, cb);\n            }\n        }\n\n        function isImgOk(img) {\n            if ( !img.complete ) return false; /* Only IE is correct here */\n            if ( typeof img.naturalWidth != UNDEFINED && img.naturalWidth == 0 ) return false; /* Other Browsers */\n            return true; /* No other way of checking: assume it's ok. */\n        }\n\n        /**\n         * Purce the cache.\n         */\n        function purgeCache() {\n            $.each(cache, function (n,v) {\n                delete cache[n];\n            });\n        }\n\n        // Export\n\n        load_img.exists      = exists;\n        load_img.inCache     = load_img.in_cache    = inCache;\n        load_img.isImgOk     = load_img.is_ok       = isImgOk;\n        load_img.purgeCache  = load_img.purge_cache = purgeCache;\n\n        load_img.cache       = cache;\n        load_img.VERSION     = VERSION;\n\n        return $.load_img = load_img;\n}\n\nif ( typeof window !== 'undefined' ) {\n    const $ = window.jQuery || window.Zepto;\n    if ( $ ) init($);\n}\n"],"names":["VERSION","init","$","undefined","UNDEFINED","document","window","cache","load_img","src","clb","img","hasClb","defered","Deferred","ret","evt","error","type","off","remove","show","call","reject","resolve","ctx","this","$ctx","then","proxy","promise","hide","one","trigger","length","body","prop","append","tio","setInterval","exists","cb","inCache","in_cache","isImgOk","is_ok","complete","babelHelpers.typeof","naturalWidth","purgeCache","purge_cache","each","n","v","jQuery","Zepto"],"mappings":"oZAUaA,EAAY;;;;;;;;KAEV,SAASC,EAAKC,OACjBC,EACEC,EAAYD,EAAY,GAG1BE,EAAWC,OAAOD,SAClBE,cAWKC,EAASC,EAAKC,OACfC,EAAMT,EAAE,WACRU,EAAS,mBAAqBF,EAC9BG,EAAUD,EAAST,EAAY,IAAID,EAAEY,SACrCC,EAAM,SAASA,EAAIC,OAEXC,EAAgB,SADTD,EAAIE,OAGXT,IAAMA,IACJA,IAAQQ,IACVE,IAAIF,EAAM,OAAO,QAASF,GAAKK,WAC/BC,OACDT,IACKU,KAAKX,GAAKM,GAAYR,EAAKO,GAEzBH,IACDI,IACOM,OAAOP,KAGPQ,QAAQR,EAAKP,KAKjCgB,EADOC,MAAAA,MACexB,GADfwB,KACyBC,QAE/Bd,MACGe,KAAO1B,EAAE2B,MAAMhB,EAAQe,KAAMf,KAC7BiB,QAAU5B,EAAE2B,MAAMhB,EAAQiB,QAASjB,MAGtCkB,OACAC,IAAI,OAAQjB,GACZiB,IAAI,QAASjB,IAEA,IAAfR,EAAME,KACDwB,QAAQ,iBAGRR,GAAQA,EAAIS,QAAUT,EAAI,IAAMpB,MAC1BH,EAAEG,EAAS8B,MAAM,SAEvBV,EAAIS,SAWAE,KAAK,MAAO3B,KACZ4B,OAAO1B,YAXP2B,EAAMC,YAAY,WACflC,EAAS8B,qBACMG,KACRpC,EAAEG,EAAS8B,QACbC,KAAK,MAAO3B,KACZ4B,OAAO1B,KAEhB,WAOJA,WAmDF6B,gBA3BO/B,EAAKgC,MACZhC,KAAOF,YACFkC,EAAGlC,EAAME,IAAMA,GACdF,EAAME,MAGPD,EAASC,EAAKgC,MAsBnBC,QAAclC,EAASmC,kBA1CflC,UACNA,KAAOF,KA0CTqC,QAAcpC,EAASqC,eAnBflC,WACPA,EAAImC,WACLC,EAAOpC,EAAIqC,eAAgB5C,GAAiC,GAApBO,EAAIqC,iBAkB5CC,WAAczC,EAAS0C,yBAV1BC,KAAK5C,EAAO,SAAU6C,EAAEC,UACf9C,EAAM6C,QAWZ7C,MAAcA,IACdP,QAAcA,EAEhBE,EAAEM,SAAWA,EAG5B,GAAuB,oBAAXF,OAAyB,KAC3BJ,EAAII,OAAOgD,QAAUhD,OAAOiD,MAC7BrD,GAAID,EAAKC"}