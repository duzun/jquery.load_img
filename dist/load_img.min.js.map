{"version":3,"file":"load_img.min.js","sources":["../load_img.js"],"sourcesContent":["/**\n *  Load images asynchronously and cache them.\n *\n *  @license MIT\n *  @git https://github.com/duzun/jquery.load_img\n *  @author Dumitru Uzun (DUzun.Me)\n *  @version 1.4.0\n */\n\n// ---------------------------------------------------------------------------\nconst VERSION   = '1.4.0';\n\ninit.VERSION = VERSION;\n\nexport default function init($, global) {\n    global = typeof globalThis != 'undefined' ? globalThis : window;\n\n        var undefined; //jshint ignore:line\n        const UNDEFINED = undefined + '';\n\n        // ---------------------------------------------------------------------------\n        const { document } = global\n        ,   cache = {}\n        ;\n\n        /**\n         * Load an image to cache.\n         *\n         * @param string src - source URL of the iamge\n         * @param callback clb.call(img: $(Image), src|false, event: $.Event)\n         *\n         * @return $(Image) element\n         */\n        function load_img(src, clb) {\n            var img = $('<img />')\n            ,   hasClb = 'function' == typeof clb\n            ,   defered = hasClb ? undefined : new $.Deferred()\n            ,   ret = function ret(evt) {\n                    var type = evt.type\n                    ,   error = type == 'error'\n                    ;\n                    evt.src = src;\n                    cache[src] = !error;\n                    img.off(error?'load':'error', ret).remove();\n                    img.show();\n                    if(hasClb) {\n                        clb.call(img, error?false:src, evt);\n                    }\n                    else if ( defered ) {\n                        if ( error ) {\n                            defered.reject(evt);\n                        }\n                        else {\n                            defered.resolve(evt, src);\n                        }\n                    }\n                }\n            ,   that = this\n            ,   ctx = that && that != $ && that.$ctx\n            ;\n            if ( defered ) {\n                img.then = $.proxy(defered.then, defered);\n                img.promise = $.proxy(defered.promise, defered);\n            }\n            img\n                .hide()\n                .one('load', ret)\n                .one('error', ret)\n            ;\n            if(cache[src] === false) {\n                img.trigger('error');\n            }\n            else {\n                if(!ctx || !ctx.length || ctx[0] == document) {\n                    ctx = $(document.body||'body');\n                }\n                if(!ctx.length) {\n                    var tio = setInterval(function () {\n                        if(document.body) {\n                            clearInterval(tio);\n                            ctx = $(document.body);\n                            img.prop('src', src);\n                            ctx.append(img);\n                        }\n                    }, 50);\n                }\n                else {\n                    img.prop('src', src);\n                    ctx.append(img);\n                }\n            }\n            return img;\n        }\n\n        /**\n         * Check whether src has beed loaded (either success or error)\n         *\n         * @param string src - source URL of the iamge\n         *\n         * @return bool true if src in cache, false otherwise\n         */\n        function inCache(src) {\n            return src in cache;\n        }\n\n        /**\n         * Check whether image with src exists.\n         *\n         * @param string src - source URL of the iamge\n         * @param callback cb(src|false)\n         *\n         * Note: If cb supplied and src not in cache, it will trigger\n         *\n         * @return bool|undefined true if exists (and cached), false if doesn't exist (error on load), undefined if never loaded (not in cache)\n         */\n        function exists(src, cb) {\n            if ( src in cache ) {\n                cb && cb(cache[src]&&src);\n                return cache[src];\n            }\n            else {\n                cb && load_img(src, cb);\n            }\n        }\n\n        function isImgOk(img) {\n            if ( !img.complete ) return false; /* Only IE is correct here */\n            if ( typeof img.naturalWidth != UNDEFINED && img.naturalWidth == 0 ) return false; /* Other Browsers */\n            return true; /* No other way of checking: assume it's ok. */\n        }\n\n        /**\n         * Purce the cache.\n         */\n        function purgeCache() {\n            $.each(cache, function (n,v) {\n                delete cache[n];\n            });\n        }\n\n        // Export\n\n        load_img.exists      = exists;\n        load_img.inCache     = load_img.in_cache    = inCache;\n        load_img.isImgOk     = load_img.is_ok       = isImgOk;\n        load_img.purgeCache  = load_img.purge_cache = purgeCache;\n\n        load_img.cache       = cache;\n        load_img.VERSION     = VERSION;\n\n        return $.load_img = load_img;\n}\n\n;(function (global) {\n    const $ = global.jQuery || global.Zepto;\n    if ($) init($, global);\n}(typeof globalThis != 'undefined' ? globalThis : typeof window != 'undefined' ? window : global));\n"],"names":["VERSION","init","$","global","undefined","globalThis","window","document","cache","load_img","src","clb","img","hasClb","defered","Deferred","ret","evt","error","type","off","remove","show","call","reject","resolve","that","this","ctx","$ctx","then","proxy","promise","hide","one","trigger","length","body","prop","append","tio","setInterval","clearInterval","exists","cb","inCache","in_cache","isImgOk","is_ok","complete","_typeof","naturalWidth","purgeCache","purge_cache","each","n","v","jQuery","Zepto"],"mappings":";;;;;;;;KAUA,IAAMA,EAAY,QAIH,SAASC,EAAKC,EAAGC,GAGpBC,IAAAA,EAFRD,EAA8B,oBAAdE,WAA4BA,WAAaC,OAGrD,IAGQC,EAAaJ,EAAbI,SACJC,EAAQ,GAWZ,SAASC,EAASC,EAAKC,GACnB,IAAIC,EAAMV,EAAE,WACRW,EAAS,mBAAqBF,EAC9BG,EAAUD,EAAST,EAAY,IAAIF,EAAEa,SACrCC,EAAM,SAASA,EAAIC,GACf,IACIC,EAAgB,SADTD,EAAIE,KAGfF,EAAIP,IAAMA,EACVF,EAAME,IAAQQ,EACdN,EAAIQ,IAAIF,EAAM,OAAO,QAASF,GAAKK,SACnCT,EAAIU,OACDT,EACCF,EAAIY,KAAKX,GAAKM,GAAYR,EAAKO,GAEzBH,IACDI,EACDJ,EAAQU,OAAOP,GAGfH,EAAQW,QAAQR,EAAKP,KAIjCgB,EAAOC,KACPC,EAAMF,GAAQA,GAAQxB,GAAKwB,EAAKG,KAWpC,GATKf,IACDF,EAAIkB,KAAO5B,EAAE6B,MAAMjB,EAAQgB,KAAMhB,GACjCF,EAAIoB,QAAU9B,EAAE6B,MAAMjB,EAAQkB,QAASlB,IAE3CF,EACKqB,OACAC,IAAI,OAAQlB,GACZkB,IAAI,QAASlB,IAEA,IAAfR,EAAME,GACLE,EAAIuB,QAAQ,cAMZ,GAHIP,GAAQA,EAAIQ,QAAUR,EAAI,IAAMrB,IAChCqB,EAAM1B,EAAEK,EAAS8B,MAAM,SAEvBT,EAAIQ,OAWJxB,EAAI0B,KAAK,MAAO5B,GAChBkB,EAAIW,OAAO3B,QAXX,IAAI4B,EAAMC,aAAY,WACflC,EAAS8B,OACRK,cAAcF,GACdZ,EAAM1B,EAAEK,EAAS8B,MACjBzB,EAAI0B,KAAK,MAAO5B,GAChBkB,EAAIW,OAAO3B,MAEhB,IAOX,OAAOA,EA2DX,OARAH,EAASkC,OA3BT,SAAgBjC,EAAKkC,GACZlC,GAAAA,KAAOF,EAEDA,OADPoC,GAAMA,EAAGpC,EAAME,IAAMA,GACdF,EAAME,GAGbkC,GAAMnC,EAASC,EAAKkC,IAsB5BnC,EAASoC,QAAcpC,EAASqC,SA1CvBD,SAAQnC,GACNA,OAAAA,KAAOF,GA0ClBC,EAASsC,QAActC,EAASuC,MAnBvBD,SAAQnC,GACb,QAAMA,EAAIqC,WA5GI7C,aA6GT8C,EAAOtC,EAAIuC,eAAiD,GAApBvC,EAAIuC,eAkBrD1C,EAAS2C,WAAc3C,EAAS4C,YAXhC,WACInD,EAAEoD,KAAK9C,GAAO,SAAU+C,EAAEC,UACfhD,EAAM+C,OAWrB9C,EAASD,MAAcA,EACvBC,EAAST,QAAcA,EAEhBE,EAAEO,SAAWA,SA1I5BR,EAAKD,QAAUA,EA6Ib,SAAUG,GACFD,IAAAA,EAAIC,EAAOsD,QAAUtD,EAAOuD,MAC9BxD,GAAGD,EAAKC,EAAGC,GAFjB,CAGqB,oBAAdE,WAA4BA,WAA8B,oBAAVC,OAAwBA,OAASH"}