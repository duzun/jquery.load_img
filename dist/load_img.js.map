{"version":3,"file":"load_img.js","sources":["../load_img.js"],"sourcesContent":["/**\n *  Load images asynchronously and cache them.\n *\n *  @license MIT\n *  @git https://github.com/duzun/jquery.load_img\n *  @author Dumitru Uzun (DUzun.Me)\n *  @version 1.4.0\n */\n\n// ---------------------------------------------------------------------------\nconst VERSION   = '1.4.0';\n\ninit.VERSION = VERSION;\n\nexport default function init($, global) {\n    global = typeof globalThis != 'undefined' ? globalThis : window;\n\n        var undefined; //jshint ignore:line\n        const UNDEFINED = undefined + '';\n\n        // ---------------------------------------------------------------------------\n        const { document } = global\n        ,   cache = {}\n        ;\n\n        /**\n         * Load an image to cache.\n         *\n         * @param string src - source URL of the iamge\n         * @param callback clb.call(img: $(Image), src|false, event: $.Event)\n         *\n         * @return $(Image) element\n         */\n        function load_img(src, clb) {\n            var img = $('<img />')\n            ,   hasClb = 'function' == typeof clb\n            ,   defered = hasClb ? undefined : new $.Deferred()\n            ,   ret = function ret(evt) {\n                    var type = evt.type\n                    ,   error = type == 'error'\n                    ;\n                    evt.src = src;\n                    cache[src] = !error;\n                    img.off(error?'load':'error', ret).remove();\n                    img.show();\n                    if(hasClb) {\n                        clb.call(img, error?false:src, evt);\n                    }\n                    else if ( defered ) {\n                        if ( error ) {\n                            defered.reject(evt);\n                        }\n                        else {\n                            defered.resolve(evt, src);\n                        }\n                    }\n                }\n            ,   that = this\n            ,   ctx = that && that != $ && that.$ctx\n            ;\n            if ( defered ) {\n                img.then = $.proxy(defered.then, defered);\n                img.promise = $.proxy(defered.promise, defered);\n            }\n            img\n                .hide()\n                .one('load', ret)\n                .one('error', ret)\n            ;\n            if(cache[src] === false) {\n                img.trigger('error');\n            }\n            else {\n                if(!ctx || !ctx.length || ctx[0] == document) {\n                    ctx = $(document.body||'body');\n                }\n                if(!ctx.length) {\n                    var tio = setInterval(function () {\n                        if(document.body) {\n                            clearInterval(tio);\n                            ctx = $(document.body);\n                            img.prop('src', src);\n                            ctx.append(img);\n                        }\n                    }, 50);\n                }\n                else {\n                    img.prop('src', src);\n                    ctx.append(img);\n                }\n            }\n            return img;\n        }\n\n        /**\n         * Check whether src has beed loaded (either success or error)\n         *\n         * @param string src - source URL of the iamge\n         *\n         * @return bool true if src in cache, false otherwise\n         */\n        function inCache(src) {\n            return src in cache;\n        }\n\n        /**\n         * Check whether image with src exists.\n         *\n         * @param string src - source URL of the iamge\n         * @param callback cb(src|false)\n         *\n         * Note: If cb supplied and src not in cache, it will trigger\n         *\n         * @return bool|undefined true if exists (and cached), false if doesn't exist (error on load), undefined if never loaded (not in cache)\n         */\n        function exists(src, cb) {\n            if ( src in cache ) {\n                cb && cb(cache[src]&&src);\n                return cache[src];\n            }\n            else {\n                cb && load_img(src, cb);\n            }\n        }\n\n        function isImgOk(img) {\n            if ( !img.complete ) return false; /* Only IE is correct here */\n            if ( typeof img.naturalWidth != UNDEFINED && img.naturalWidth == 0 ) return false; /* Other Browsers */\n            return true; /* No other way of checking: assume it's ok. */\n        }\n\n        /**\n         * Purce the cache.\n         */\n        function purgeCache() {\n            $.each(cache, function (n,v) {\n                delete cache[n];\n            });\n        }\n\n        // Export\n\n        load_img.exists      = exists;\n        load_img.inCache     = load_img.in_cache    = inCache;\n        load_img.isImgOk     = load_img.is_ok       = isImgOk;\n        load_img.purgeCache  = load_img.purge_cache = purgeCache;\n\n        load_img.cache       = cache;\n        load_img.VERSION     = VERSION;\n\n        return $.load_img = load_img;\n}\n\n;(function (global) {\n    const $ = global.jQuery || global.Zepto;\n    if ($) init($, global);\n}(typeof globalThis != 'undefined' ? globalThis : typeof window != 'undefined' ? window : global));\n"],"names":["VERSION","init","$","global","globalThis","window","undefined","UNDEFINED","document","cache","load_img","src","clb","img","hasClb","defered","Deferred","ret","evt","type","error","off","remove","show","call","reject","resolve","that","ctx","$ctx","then","proxy","promise","hide","one","trigger","length","body","tio","setInterval","clearInterval","prop","append","inCache","exists","cb","isImgOk","complete","naturalWidth","purgeCache","each","n","v","in_cache","is_ok","purge_cache","jQuery","Zepto"],"mappings":";;;;;;;;;;;;;;;;EAAA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EAEA;EACA,IAAMA,OAAO,GAAK,OAAlB,CAAA;EAEAC,IAAI,CAACD,OAAL,GAAeA,OAAf,CAAA;EAEe,SAASC,IAAT,CAAcC,CAAd,EAAiBC,MAAjB,EAAyB;EACpCA,EAAAA,MAAM,GAAG,OAAOC,UAAP,IAAqB,WAArB,GAAmCA,UAAnC,GAAgDC,MAAzD,CAAA;EAEI,EAAIC,IAAAA,WAAJ,CAHgC;;EAIhC,EAAA,IAAMC,SAAS,GAAGD,WAAS,GAAG,EAA9B,CAJgC;;EAOhC,EAAA,IAAA,OAAA,GAAqBH,MAArB;EAAA,MAAQK,QAAR,WAAQA,QAAR;EAAA,MACIC,KADJ,GACY,EADZ,CAAA;EAIA;EACR;EACA;EACA;EACA;EACA;EACA;EACA;;EACQ,EAAA,SAASC,QAAT,CAAkBC,GAAlB,EAAuBC,GAAvB,EAA4B;EACxB,IAAA,IAAIC,GAAG,GAAGX,CAAC,CAAC,SAAD,CAAX;EAAA,QACIY,MAAM,GAAG,UAAc,IAAA,OAAOF,GADlC;EAAA,QAEIG,OAAO,GAAGD,MAAM,GAAGR,WAAH,GAAe,IAAIJ,CAAC,CAACc,QAAN,EAFnC;EAAA,QAGIC,GAAG,GAAG,SAASA,GAAT,CAAaC,GAAb,EAAkB;EACpB,MAAA,IAAIC,IAAI,GAAGD,GAAG,CAACC,IAAf;EAAA,UACIC,KAAK,GAAGD,IAAI,IAAI,OADpB,CAAA;EAGAD,MAAAA,GAAG,CAACP,GAAJ,GAAUA,GAAV,CAAA;EACAF,MAAAA,KAAK,CAACE,GAAD,CAAL,GAAa,CAACS,KAAd,CAAA;EACAP,MAAAA,GAAG,CAACQ,GAAJ,CAAQD,KAAK,GAAC,MAAD,GAAQ,OAArB,EAA8BH,GAA9B,CAAA,CAAmCK,MAAnC,EAAA,CAAA;EACAT,MAAAA,GAAG,CAACU,IAAJ,EAAA,CAAA;;EACA,MAAA,IAAGT,MAAH,EAAW;EACPF,QAAAA,GAAG,CAACY,IAAJ,CAASX,GAAT,EAAcO,KAAK,GAAC,KAAD,GAAOT,GAA1B,EAA+BO,GAA/B,CAAA,CAAA;EACH,OAFD,MAGK,IAAKH,OAAL,EAAe;EAChB,QAAA,IAAKK,KAAL,EAAa;EACTL,UAAAA,OAAO,CAACU,MAAR,CAAeP,GAAf,CAAA,CAAA;EACH,SAFD,MAGK;EACDH,UAAAA,OAAO,CAACW,OAAR,CAAgBR,GAAhB,EAAqBP,GAArB,CAAA,CAAA;EACH,SAAA;EACJ,OAAA;EACJ,KAtBL;EAAA,QAuBIgB,IAAI,GAAG,IAvBX;EAAA,QAwBIC,GAAG,GAAGD,IAAI,IAAIA,IAAI,IAAIzB,CAAhB,IAAqByB,IAAI,CAACE,IAxBpC,CAAA;;EA0BA,IAAA,IAAKd,OAAL,EAAe;EACXF,MAAAA,GAAG,CAACiB,IAAJ,GAAW5B,CAAC,CAAC6B,KAAF,CAAQhB,OAAO,CAACe,IAAhB,EAAsBf,OAAtB,CAAX,CAAA;EACAF,MAAAA,GAAG,CAACmB,OAAJ,GAAc9B,CAAC,CAAC6B,KAAF,CAAQhB,OAAO,CAACiB,OAAhB,EAAyBjB,OAAzB,CAAd,CAAA;EACH,KAAA;;EACDF,IAAAA,GAAG,CACEoB,IADL,EAAA,CAEKC,GAFL,CAES,MAFT,EAEiBjB,GAFjB,CAGKiB,CAAAA,GAHL,CAGS,OAHT,EAGkBjB,GAHlB,CAAA,CAAA;;EAKA,IAAA,IAAGR,KAAK,CAACE,GAAD,CAAL,KAAe,KAAlB,EAAyB;EACrBE,MAAAA,GAAG,CAACsB,OAAJ,CAAY,OAAZ,CAAA,CAAA;EACH,KAFD,MAGK;EACD,MAAA,IAAG,CAACP,GAAD,IAAQ,CAACA,GAAG,CAACQ,MAAb,IAAuBR,GAAG,CAAC,CAAD,CAAH,IAAUpB,QAApC,EAA8C;EAC1CoB,QAAAA,GAAG,GAAG1B,CAAC,CAACM,QAAQ,CAAC6B,IAAT,IAAe,MAAhB,CAAP,CAAA;EACH,OAAA;;EACD,MAAA,IAAG,CAACT,GAAG,CAACQ,MAAR,EAAgB;EACZ,QAAA,IAAIE,GAAG,GAAGC,WAAW,CAAC,YAAY;EAC9B,UAAG/B,IAAAA,QAAQ,CAAC6B,IAAZ,EAAkB;EACdG,YAAAA,aAAa,CAACF,GAAD,CAAb,CAAA;EACAV,YAAAA,GAAG,GAAG1B,CAAC,CAACM,QAAQ,CAAC6B,IAAV,CAAP,CAAA;EACAxB,YAAAA,GAAG,CAAC4B,IAAJ,CAAS,KAAT,EAAgB9B,GAAhB,CAAA,CAAA;EACAiB,YAAAA,GAAG,CAACc,MAAJ,CAAW7B,GAAX,CAAA,CAAA;EACH,WAAA;EACJ,SAPoB,EAOlB,EAPkB,CAArB,CAAA;EAQH,OATD,MAUK;EACDA,QAAAA,GAAG,CAAC4B,IAAJ,CAAS,KAAT,EAAgB9B,GAAhB,CAAA,CAAA;EACAiB,QAAAA,GAAG,CAACc,MAAJ,CAAW7B,GAAX,CAAA,CAAA;EACH,OAAA;EACJ,KAAA;;EACD,IAAA,OAAOA,GAAP,CAAA;EACH,GAAA;EAED;EACR;EACA;EACA;EACA;EACA;EACA;;;EACQ,EAAS8B,SAAAA,OAAT,CAAiBhC,GAAjB,EAAsB;EAClB,IAAOA,OAAAA,GAAG,IAAIF,KAAd,CAAA;EACH,GAAA;EAED;EACR;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;;EACQ,EAAA,SAASmC,MAAT,CAAgBjC,GAAhB,EAAqBkC,EAArB,EAAyB;EACrB,IAAKlC,IAAAA,GAAG,IAAIF,KAAZ,EAAoB;EAChBoC,MAAAA,EAAE,IAAIA,EAAE,CAACpC,KAAK,CAACE,GAAD,CAAL,IAAYA,GAAb,CAAR,CAAA;EACA,MAAOF,OAAAA,KAAK,CAACE,GAAD,CAAZ,CAAA;EACH,KAHD,MAIK;EACDkC,MAAAA,EAAE,IAAInC,QAAQ,CAACC,GAAD,EAAMkC,EAAN,CAAd,CAAA;EACH,KAAA;EACJ,GAAA;;EAED,EAASC,SAAAA,OAAT,CAAiBjC,GAAjB,EAAsB;EAClB,IAAA,IAAK,CAACA,GAAG,CAACkC,QAAV,EAAqB,OAAO,KAAP,CAAA;EAAc;;EACnC,IAAA,IAAK,OAAOlC,CAAAA,GAAG,CAACmC,YAAX,KAA2BzC,SAA3B,IAAwCM,GAAG,CAACmC,YAAJ,IAAoB,CAAjE,EAAqE,OAAO,KAAP,CAAA;EAAc;;EACnF,IAAA,OAAO,IAAP,CAAA;EAAa;EAChB,GAAA;EAED;EACR;EACA;;;EACQ,EAAA,SAASC,UAAT,GAAsB;EAClB/C,IAAAA,CAAC,CAACgD,IAAF,CAAOzC,KAAP,EAAc,UAAU0C,CAAV,EAAYC,CAAZ,EAAe;EACzB,MAAO3C,OAAAA,KAAK,CAAC0C,CAAD,CAAZ,CAAA;EACH,KAFD,CAAA,CAAA;EAGH,GA5H+B;;;EAgIhCzC,EAAAA,QAAQ,CAACkC,MAAT,GAAuBA,MAAvB,CAAA;EACAlC,EAAAA,QAAQ,CAACiC,OAAT,GAAuBjC,QAAQ,CAAC2C,QAAT,GAAuBV,OAA9C,CAAA;EACAjC,EAAAA,QAAQ,CAACoC,OAAT,GAAuBpC,QAAQ,CAAC4C,KAAT,GAAuBR,OAA9C,CAAA;EACApC,EAAAA,QAAQ,CAACuC,UAAT,GAAuBvC,QAAQ,CAAC6C,WAAT,GAAuBN,UAA9C,CAAA;EAEAvC,EAAAA,QAAQ,CAACD,KAAT,GAAuBA,KAAvB,CAAA;EACAC,EAAAA,QAAQ,CAACV,OAAT,GAAuBA,OAAvB,CAAA;EAEA,EAAA,OAAOE,CAAC,CAACQ,QAAF,GAAaA,QAApB,CAAA;EACP,CAAA;;EAEC,CAAA,UAAUP,MAAV,EAAkB;EAChB,EAAMD,IAAAA,CAAC,GAAGC,MAAM,CAACqD,MAAP,IAAiBrD,MAAM,CAACsD,KAAlC,CAAA;EACA,EAAA,IAAIvD,CAAJ,EAAOD,IAAI,CAACC,CAAD,EAAIC,MAAJ,CAAJ,CAAA;EACV,CAHC,EAGA,OAAOC,UAAP,IAAqB,WAArB,GAAmCA,UAAnC,GAAgD,OAAOC,MAAP,IAAiB,WAAjB,GAA+BA,MAA/B,GAAwCF,MAHxF,CAAD;;;;;;;;"}