{"version":3,"file":"load_img.js","sources":["load_img.js"],"sourcesContent":["/**\n *  Load images asynchronously and cache them.\n *\n *  @license MIT\n *  @git https://github.com/duzun/jquery.load_img\n *  @author Dumitru Uzun (DUzun.Me)\n *  @version 1.3.0\n */\n\n// ---------------------------------------------------------------------------\nexport const VERSION   = '1.3.0';\n\nexport default function init($) {\n        var undefined; //jshint ignore:line\n        const UNDEFINED = undefined + '';\n\n        // ---------------------------------------------------------------------------\n        var document = window.document\n        ,   cache = {}\n        ;\n\n        /**\n         * Load an image to cache.\n         *\n         * @param string src - source URL of the iamge\n         * @param callback clb.call(img: $(Image), src|false, event: $.Event)\n         *\n         * @return $(Image) element\n         */\n        function load_img(src, clb) {\n            var img = $('<img />')\n            ,   hasClb = 'function' == typeof clb\n            ,   defered = hasClb ? undefined : new $.Deferred()\n            ,   ret = function ret(evt) {\n                    var type = evt.type\n                    ,   error = type == 'error'\n                    ;\n                    evt.src = src;\n                    cache[src] = !error;\n                    img.off(error?'load':'error', ret).remove();\n                    img.show();\n                    if(hasClb) {\n                        clb.call(img, error?false:src, evt);\n                    }\n                    else if ( defered ) {\n                        if ( error ) {\n                            defered.reject(evt);\n                        }\n                        else {\n                            defered.resolve(evt, src);\n                        }\n                    }\n                }\n            ,   that = this\n            ,   ctx = that && that != $ && that.$ctx\n            ;\n            if ( defered ) {\n                img.then = $.proxy(defered.then, defered);\n                img.promise = $.proxy(defered.promise, defered);\n            }\n            img\n                .hide()\n                .one('load', ret)\n                .one('error', ret)\n            ;\n            if(cache[src] === false) {\n                img.trigger('error');\n            }\n            else {\n                if(!ctx || !ctx.length || ctx[0] == document) {\n                    ctx = $(document.body||'body');\n                }\n                if(!ctx.length) {\n                    var tio = setInterval(function () {\n                        if(document.body) {\n                            clearInterval(tio);\n                            ctx = $(document.body);\n                            img.prop('src', src);\n                            ctx.append(img);\n                        }\n                    }, 50);\n                }\n                else {\n                    img.prop('src', src);\n                    ctx.append(img);\n                }\n            }\n            return img;\n        }\n\n        /**\n         * Check whether src has beed loaded (either success or error)\n         *\n         * @param string src - source URL of the iamge\n         *\n         * @return bool true if src in cache, false otherwise\n         */\n        function inCache(src) {\n            return src in cache;\n        }\n\n        /**\n         * Check whether image with src exists.\n         *\n         * @param string src - source URL of the iamge\n         * @param callback cb(src|false)\n         *\n         * Note: If cb supplied and src not in cache, it will trigger\n         *\n         * @return bool|undefined true if exists (and cached), false if doesn't exist (error on load), undefined if never loaded (not in cache)\n         */\n        function exists(src, cb) {\n            if ( src in cache ) {\n                cb && cb(cache[src]&&src);\n                return cache[src];\n            }\n            else {\n                cb && load_img(src, cb);\n            }\n        }\n\n        function isImgOk(img) {\n            if ( !img.complete ) return false; /* Only IE is correct here */\n            if ( typeof img.naturalWidth != UNDEFINED && img.naturalWidth == 0 ) return false; /* Other Browsers */\n            return true; /* No other way of checking: assume it's ok. */\n        }\n\n        /**\n         * Purce the cache.\n         */\n        function purgeCache() {\n            $.each(cache, function (n,v) {\n                delete cache[n];\n            });\n        }\n\n        // Export\n\n        load_img.exists      = exists;\n        load_img.inCache     = load_img.in_cache    = inCache;\n        load_img.isImgOk     = load_img.is_ok       = isImgOk;\n        load_img.purgeCache  = load_img.purge_cache = purgeCache;\n\n        load_img.cache       = cache;\n        load_img.VERSION     = VERSION;\n\n        return $.load_img = load_img;\n}\n\nif ( typeof window !== 'undefined' ) {\n    const $ = window.jQuery || window.Zepto;\n    if ( $ ) init($);\n}\n"],"names":["VERSION","init","$","undefined","UNDEFINED","document","window","cache","load_img","src","clb","img","hasClb","defered","Deferred","ret","evt","type","error","off","remove","show","call","reject","resolve","that","ctx","$ctx","then","proxy","promise","hide","one","trigger","length","body","tio","setInterval","clearInterval","prop","append","inCache","exists","cb","isImgOk","complete","babelHelpers.typeof","naturalWidth","purgeCache","each","n","v","in_cache","is_ok","purge_cache","jQuery","Zepto"],"mappings":"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"}